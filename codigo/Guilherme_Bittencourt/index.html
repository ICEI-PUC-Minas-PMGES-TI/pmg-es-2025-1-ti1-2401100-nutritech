<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localiza칞칚o das ONGs</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=ABeeZee&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    
    <!-- Script para Geoapify -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <style>
        /* Garantindo que o mapa tenha o tamanho adequado */
        #map {
            height: 400px;  /* Altura ajustada para o mapa */
            width: 80%;     /* Largura ajustada para o mapa */
            margin: 0 auto; /* Centralizar o mapa */
            position: relative;
        }
    </style>
</head>
<body>
    <header class="d-flex justify-content-between align-items-center p-3 bg-light">
        <a href="#" class="d-flex align-items-center">
            <img src="imgs/logo.png" alt="Logo" class="logo me-3">
            <h2 class="m-0 text-center">Alimenta칞칚o <br> Para <br> Todos</h2>
        </a>
        <a href="#" class="usuario-container d-flex align-items-center">
            <h3 class="m-0 me-2">Usu치rio</h3>
            <img src="imgs/usuario.png" alt="Usu치rio" class="usuario">
        </a>
    </header>

    <main>
  <h1>Localiza칞칚o das Institui칞칫es</h1>

  <!-- Layout com Bootstrap - Filtros  esquerda e Mapa  direita -->
  <div class="container-fluid">
    <div class="row">

      <!-- Coluna dos Filtros -->
      <div class="col-md-4 mb-4 mb-md-0">
  <div class="filters">

    <!-- Filtro por Tipo -->
    <div>
      <label for="filterType">Filtrar por tipo de doa칞칚o:</label>
      <select id="filterType" onchange="updateFilters()">
        <option value="all">Todos</option>
        <option value="alimentos">Alimentos</option>
        <option value="dinheiro">Dinheiro</option>
        <option value="voluntariado">Voluntariado</option>
      </select>
    </div>

    <!-- Filtro por Raio -->
    <div>
      <label for="filterRadius">Mostrar ONGs na dist칙ncia de:</label>
      <input type="range" id="filterRadius" min="1" max="50" value="10" class="form-range">
      <span id="radiusValue">10</span> km
    </div>

  </div>
</div>
      <!-- Coluna do Mapa -->
      <div class="col-md-8">
        <div id="map"></div>
      </div>

    </div>
  </div>
</main>

    <footer class="bg-light py-4">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="footer-left text-center text-md-start">
                <h3 class="mb-2">Local</h3>
                <p>Belo Horizonte</p>
            </div>

            <div class="footer-center text-center">
                <p>춸 2025 NutriTech</p>
            </div>

            <div class="footer-right text-center text-md-end">
                <h3 class="mb-2">Contato</h3>
                <p class="mb-1">(31) 9999-6666</p>
                <p>nutritech@pucminas.com.br</p>
            </div>
        </div>
    </footer>

    <script>
        const API_KEY = '5c44b3606f0c4083a694018d9e277792'; // Sua chave de API do Geoapify
        let map;
        let userLocation;
        let markers = [];

        // Fun칞칚o para inicializar o mapa usando a API do Geoapify
        function initMap() {
            map = new window.L.Map("map", {
                center: [ -19.8191, -43.9378 ], // Belo Horizonte
                zoom: 12,
                zoomControl: true,
            });

            // Usando a URL fornecida para o estilo carto
            window.L.tileLayer(
                `https://maps.geoapify.com/v1/tile/carto/{z}/{x}/{y}.png?&apiKey=${API_KEY}`,
                {
                    maxZoom: 19,
                    attribution: "춸 OpenStreetMap contributors"
                }
            ).addTo(map);

            // Definindo as ONGs com suas localiza칞칫es (latitude e longitude)
            const ongs = [
                { name: "Comida que Abra칞a", lat: -19.9191, lng: -43.9378, tipo: "alimentos" },
                { name: "ONG Verde", lat: -19.8300, lng: -43.9200, tipo: "voluntariado" },
                { name: "Funda칞칚o Dom Bosco", lat: -19.8320, lng: -43.9320, tipo: "dinheiro" },
            ];

            // Definindo os 칤cones personalizados diretamente no script
const iconDinheiro = new L.Icon({
    iconUrl: 'imgs/iconedinheiro.png',
    iconSize: [32, 40],
    iconAnchor: [16, 40],
    popupAnchor: [0, -40]
});

const iconAlimento = new L.Icon({
    iconUrl: 'imgs/iconecomida.png',
    iconSize: [32, 40],
    iconAnchor: [16, 40],
    popupAnchor: [0, -40]
});

const iconVoluntario = new L.Icon({
    iconUrl: 'imgs/iconevoluntarios.png',
    iconSize: [32, 40],
    iconAnchor: [16, 40],
    popupAnchor: [0, -40]
});

// Adicionando os marcadores para as ONGs com 칤cones personalizados
ongs.forEach((ong) => {
    let icon;
    switch (ong.tipo) {
        case 'dinheiro':
            icon = iconDinheiro;
            break;
        case 'alimentos':
            icon = iconAlimento;
            break;
        case 'voluntariado':
            icon = iconVoluntario;
            break;
        default:
            icon = L.icon.default; // 칈cone padr칚o se n칚o houver correspond칡ncia
    }

    const marker = window.L.marker([ong.lat, ong.lng], { icon })
        .addTo(map)
        .bindPopup(ong.name);

    markers.push({ ...ong, marker });
});

            // Obtendo a localiza칞칚o do usu치rio
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    userLocation = [position.coords.latitude, position.coords.longitude];

                    // Adicionando um marcador para a posi칞칚o do usu치rio
                    window.L.marker(userLocation)
                        .addTo(map)
                        .bindPopup("Sua localiza칞칚o");

                    // Atualizar os filtros quando o mapa estiver pronto
                    updateFilters();
                });
            }
        }

        function updateFilters() {
    const typeFilter = document.getElementById("filterType").value;
    const radius = parseFloat(document.getElementById("filterRadius").value); // Em km

    // Mostra o valor em tempo real
    document.getElementById("radiusValue").textContent = radius;

    let filteredOngs = [...markers]; // Cria c칩pia dos marcadores

    // Filtrar por tipo de ONG
    if (typeFilter !== "all") {
        filteredOngs = filteredOngs.filter(ong => ong.tipo === typeFilter);
    }

    // Se tiver localiza칞칚o do usu치rio, filtrar por dist칙ncia
    if (userLocation) {
        filteredOngs = filteredOngs.map(ong => ({
            ...ong,
            distance: getDistance(userLocation, [ong.lat, ong.lng])
        }));

        // Filtrar pelo raio selecionado
        filteredOngs = filteredOngs.filter(ong => ong.distance <= radius);

        // 游대 Ordenar sempre por dist칙ncia (sem precisar de checkbox)
        filteredOngs.sort((a, b) => a.distance - b.distance);
    }

    // Remover todos os marcadores do mapa
    markers.forEach(markerObj => {
        map.removeLayer(markerObj.marker);
    });

    // Adicionar apenas os marcadores filtrados
    filteredOngs.forEach(ong => {
        map.addLayer(ong.marker);
    });

    // Garantir que o pin do usu치rio sempre fique vis칤vel
    const userMarker = markers.find(m => m.tipo === "usuario")?.marker;
    if (userMarker && !map.hasLayer(userMarker)) {
        map.addLayer(userMarker);
    }
}
        
        // Fun칞칚o para calcular a dist칙ncia entre duas coordenadas
        function getDistance(coord1, coord2) {
            const lat1 = coord1[0];
            const lon1 = coord1[1];
            const lat2 = coord2[0];
            const lon2 = coord2[1];
            
            const R = 6371; // Raio da Terra em km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c; // Resultado em km
            return distance;
        }

        // Inicializar o mapa ao carregar a p치gina
        window.onload = initMap;
        // Atualiza os filtros automaticamente enquanto o usu치rio arrasta o slider
document.getElementById("filterRadius").addEventListener("input", function () {
    document.getElementById("radiusValue").textContent = this.value;
    updateFilters(); // Atualiza os marcadores em tempo real
});
    </script>
</body>
</html>



