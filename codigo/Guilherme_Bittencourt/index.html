<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localização das ONGs</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=ABeeZee&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    
    <!-- Script para Google Maps -->
    <script src="https://maps.googleapis.com/maps/api/js?key=3e7c5b6a2d9949b1a091e13a32e2f0f6&callback=initMap" async defer></script>
</head>
<body>
    <header>
        <a href="#">
            <img src="imgs/logo.png" alt="Logo" class="px-3 logo">
            <h2>Alimentação <br> Para <br> Todos</h2>
        </a>
        <a href="#" class="usuario-container">
            <h3>usuario</h3>
            <img src="imgs/usuario.png" alt="Usuário" class="usuario px-3">
        </a>
    </header>

    <main>
        <h1>Localização das Instituições</h1>
        
        <!-- Filtros -->
        <div class="filters">
            <div>
                <label for="filterType">Filtrar por tipo de doação:</label>
                <select id="filterType" onchange="updateFilters()">
                    <option value="all">Todos</option>
                    <option value="alimentos">Alimentos</option>
                    <option value="dinheiro">Dinheiro</option>
                    <option value="voluntariado">Voluntariado</option>
                </select>
            </div>

            <div>
                <label for="filterDistance">Ordenar por distância:</label>
                <input type="checkbox" id="filterDistance" onchange="updateFilters()">
            </div>
        </div>

        <!-- Mapa -->
        <div id="map" style="height: 500px; width: 100%;"></div>
    </main>

    <footer>
        <div class="footer-info px-5">
            <div>
                <h3>Contato</h3>
                <p>(31) 9999-6666</p>
                <p>nutritech@pucminas.com.br</p>
            </div>
            <div class="px-5">
                <h3>Local</h3>
                <p>Belo Horizonte</p>
            </div>
        </div>
        <img src="imgs/logo.png" alt="Logo" class="logo">
    </footer>

    <script>
        let map;
        let userLocation;
        let markers = [];

        // Função que inicializa o mapa e posiciona as ONGs
        function initMap() {
            // Mapa centralizado em Belo Horizonte
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -19.8191, lng: -43.9378 },
                zoom: 12
            });

            // Definindo as ONGs com suas localizações (latitude e longitude)
            const ongs = [
                {
                    name: "Comida que Abraça",
                    lat: -19.9191,
                    lng: -43.9378,
                    tipo: "alimentos",
                },
                {
                    name: "ONG Verde",
                    lat: -19.8300,
                    lng: -43.9200,
                    tipo: "voluntariado",
                },
                {
                    name: "Fundação Dom Bosco",
                    lat: -19.8320,
                    lng: -43.9320,
                    tipo: "dinheiro",
                },
            ];

            // Adicionando os marcadores para as ONGs
            ongs.forEach((ong) => {
                const marker = new google.maps.Marker({
                    position: { lat: ong.lat, lng: ong.lng },
                    map: map,
                    title: ong.name,
                });
                markers.push({ ...ong, marker });
            });

            // Obtendo a localização do usuário
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    userLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

                    // Adicionando um marcador para a posição do usuário
                    new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: "Sua localização",
                    });

                    // Atualizar os filtros quando o mapa estiver pronto
                    updateFilters();
                });
            }
        }

        // Função para atualizar a lista de ONGs com base no filtro
        function updateFilters() {
            const typeFilter = document.getElementById("filterType").value;
            const distanceFilter = document.getElementById("filterDistance").checked;

            // Filtrando as ONGs por tipo de doação
            let filteredOngs = markers.filter((ong) => {
                if (typeFilter !== "all" && ong.tipo !== typeFilter) {
                    return false;
                }
                return true;
            });

            // Ordenando as ONGs por distância
            if (distanceFilter && userLocation) {
                filteredOngs.sort((a, b) => {
                    const distanceA = google.maps.geometry.spherical.computeDistanceBetween(userLocation, new google.maps.LatLng(a.lat, a.lng));
                    const distanceB = google.maps.geometry.spherical.computeDistanceBetween(userLocation, new google.maps.LatLng(b.lat, b.lng));
                    return distanceA - distanceB;
                });
            }

            // Remover os marcadores antigos
            markers.forEach((markerObj) => markerObj.marker.setMap(null));

            // Adicionar os marcadores filtrados
            filteredOngs.forEach((ong) => {
                ong.marker.setMap(map);
            });
        }
    </script>
</body>
</html>
